<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>滚动容器尺寸变化时候最上方元素位置不变</title>
  <style>
    body { display: flex; align-content: center; justify-content: center; }
    .box { width: 40%; height: 600px; border: 1px solid #eee; overflow: auto; margin-top: 100px; padding: 20px;}
    .box p { margin: 0; padding-bottom: .667rem; }
  </style>
</head>
<body>
  <div id="box" class="box">
    <p>some content here</p>
  </div>
  <script>
    const _now = Date.now || function() {
      return new Date().getTime();
    };
    // underscore 节流
    const throttle = function(func, wait, options) {
      var timeout, context, args, result;
      var previous = 0;
      if (!options) options = {};

      var later = function() {
        previous = options.leading === false ? 0 : _now();
        timeout = null;
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      };

      var throttled = function() {
        var now = _now();
        if (!previous && options.leading === false) previous = now;
        var remaining = wait - (now - previous);
        context = this;
        args = arguments;
        if (remaining <= 0 || remaining > wait) {
          if (timeout) {
            clearTimeout(timeout);
            timeout = null;
          }
          previous = now;
          result = func.apply(context, args);
          if (!timeout) context = args = null;
        } else if (!timeout && options.trailing !== false) {
          timeout = setTimeout(later, remaining);
        }
        return result;
      };

      throttled.cancel = function() {
        clearTimeout(timeout);
        previous = 0;
        timeout = context = args = null;
      };

      return throttled;
    };

    const ele_box = document.getElementById('box')
    // 当前最靠近滚动容器上边缘的元素
    let targetEle = null
    // 最上边元素和滚动容器上边缘的偏移大小
    let topPOffset = null

    // 存储滚动时候最上边缘元素以及偏移大小
    const funStorePos = () => {
      var bounce = ele_box.getBoundingClientRect()
      var pointX = bounce.left + ele_box.clientWidth / 2
      var pointY = bounce.top + 12

      targetEle = document.elementsFromPoint(pointX, pointY)[0]
      if (targetEle == ele_box) {
        topPOffset = false
        return
      }
      topPOffset = Math.round(targetEle.getBoundingClientRect().top - bounce.top)
    }

    const resizefn = event => {
      if (!topPOffset) return

      var scrollTop = ele_box.scrollTop
      var currentTopPOffest = Math.round(ele_box.getBoundingClientRect().top) - Math.round(targetEle.getBoundingClientRect().top)
      ele_box.scrollTop = scrollTop - currentTopPOffest - topPOffset
    }

    ele_box.addEventListener('scroll', throttle(funStorePos, 50))
    window.addEventListener('resize', throttle(resizefn, 50))
  </script>
</body>
</html>
